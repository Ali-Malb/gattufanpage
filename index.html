<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gattu's Global Fan Page</title>
    
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>

    <style>
        /* --- GLOBAL STYLES --- */
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            background-color: #fce4ec; /* Light pink */
            color: #333; 
            margin: 0; 
            padding: 0; 
            user-select: none; 
            text-align: center;
        }

        header {
            background-color: #e91e63;
            color: white;
            padding: 30px 0;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }

        h1 { margin: 0; font-size: 2.5em; }
        h2 { color: #880e4f; }

        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 0 20px 50px 20px;
        }

        /* --- SECTIONS (CARDS) --- */
        .section-card {
            background: white;
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
            margin-bottom: 40px;
            border: 2px solid white;
        }

        /* --- LOVE BUTTON SECTION --- */
        .gattu-img {
            width: 100%;
            max-width: 300px;
            border-radius: 15px;
            border: 5px solid #ffc1e3;
            margin-bottom: 20px;
        }

        .love-btn {
            background-color: #ff4081;
            color: white;
            border: none;
            padding: 20px 50px;
            font-size: 24px;
            border-radius: 50px;
            cursor: pointer;
            transition: transform 0.1s, background-color 0.2s;
            box-shadow: 0 5px 15px rgba(233, 30, 99, 0.4);
        }

        .love-btn:hover { background-color: #d81b60; transform: scale(1.05); }
        .love-btn:active { transform: scale(0.95); }
        .love-btn:disabled { background-color: #ccc; cursor: not-allowed; transform: none; box-shadow: none; }

        /* --- GAME SECTION --- */
        .game-title {
            border-top: 2px dashed #ff80ab;
            padding-top: 30px;
            margin-top: 10px;
        }

        .score-display {
            font-size: 3em;
            font-weight: bold;
            color: #d81b60;
            margin: 10px 0;
        }

        .clicker-btn { 
            width: 150px; height: 150px; 
            border-radius: 50%; 
            background: radial-gradient(circle, #ff80ab 0%, #f50057 100%); 
            border: 5px solid white; 
            box-shadow: 0 10px 20px rgba(233, 30, 99, 0.4); 
            color: white; font-size: 40px; 
            cursor: pointer; transition: transform 0.1s; 
        }
        .clicker-btn:active { transform: scale(0.9); }

        /* SHOP */
        .shop-grid { 
            display: grid; 
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); 
            gap: 15px; 
            margin-top: 20px; 
        }
        .shop-item { 
            background: #fff0f5; 
            padding: 15px; 
            border-radius: 15px; 
            border: 2px solid #ffc1e3; 
            cursor: pointer; 
            transition: transform 0.1s, border-color 0.1s; 
            /* Fix for spasing: Enforce height stability */
            min-height: 80px;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }
        .shop-item:hover { transform: translateY(-3px); border-color: #f50057; }
        
        /* Disabled state */
        .shop-item.disabled { 
            opacity: 0.6; 
            cursor: not-allowed; 
            filter: grayscale(1); 
            transform: none !important; /* Stop movement if disabled */
        }

        /* GLOBAL RANKING BOX */
        .upload-box {
            background: #e3f2fd;
            padding: 20px;
            border-radius: 15px;
            margin-top: 30px;
            border: 1px solid #90caf9;
        }

        /* TABLE */
        table { width: 100%; border-collapse: collapse; margin-top: 15px; }
        th { background: #fce4ec; color: #880e4f; padding: 10px; }
        td { padding: 10px; border-bottom: 1px solid #eee; }

        /* INPUTS */
        input { 
            padding: 10px; 
            border: 2px solid #ddd; 
            border-radius: 5px; 
            width: 60%; 
            text-align: center;
        }
        .action-btn { 
            background-color: #2196F3; 
            color: white; border: none; 
            padding: 10px 20px; 
            border-radius: 5px; 
            cursor: pointer; 
            margin-top: 10px;
        }
    </style>
</head>
<body>

    <header>
        <h1>üåü The Official Gattu Fan Club üåü</h1>
        <p>Dedicated to the legend himself.</p>
    </header>

    <div class="container">
        
        <div class="section-card">
            <h2>Show Your Support</h2>
            <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcT6RZlboeF2Q-nIeNB-U1s88DFOmsVlCo3W0w&s" class="gattu-img" alt="Gattu">
            <br>
            <p>Click the button below to send virtual love to Gattu!</p>
            
            <button class="love-btn" id="love-btn" onclick="sendLove()">
                ‚ù§Ô∏è Send Love
            </button>
            <div id="love-status" style="margin-top: 15px; font-weight: bold; color: #880e4f;"></div>
        </div>

        <div class="section-card">
            <h2 class="game-title">üéÆ Global Fan Clicker</h2>
            <p>Collect hearts and compete with fans worldwide!</p>
            
            <div class="score-display">
                ‚ù§Ô∏è <span id="score">0</span>
            </div>
            <div style="color: #888; margin-bottom: 20px;">
                (<span id="gps">0</span> hearts / sec)
            </div>

            <button class="clicker-btn" onclick="clickHeart()">‚ù§Ô∏è</button>

            <h3 style="margin-top: 40px;">üõí Upgrade Shop</h3>
            <div id="shop" class="shop-grid"></div>

            <div class="upload-box">
                <h3>üåç Join the Global Leaderboard</h3>
                <input type="text" id="gamer-name" placeholder="Enter Your Name">
                <br>
                <button class="action-btn" onclick="window.pushScoreToFirebase()">
                    Upload Score to World Database
                </button>
                <p id="upload-status" style="font-size: 14px; color: #555; margin-top:5px;"></p>
            </div>

            <h3>üèÜ World Top 10</h3>
            <button onclick="window.fetchLeaderboard()" style="background:none; border:none; color:blue; cursor:pointer; text-decoration:underline;">Refresh Board</button>
            
            <table>
                <thead><tr><th>Rank</th><th>Name</th><th>Score</th></tr></thead>
                <tbody id="leaderboard-body"><tr><td colspan="3">Loading...</td></tr></tbody>
            </table>
        </div>

    </div>

    <script>
        // --- KEYS ---
        const EMAIL_SERVICE_ID = 'service_11ijhua';
        const EMAIL_TEMPLATE_ID = 'template_mwe3jti';
        const EMAIL_PUBLIC_KEY = 'iwl1W3R_eIaaqB7RR';

        // --- 1. SEND LOVE FUNCTION ---
        function sendLove() {
            const btn = document.getElementById('love-btn');
            const status = document.getElementById('love-status');

            btn.disabled = true; 
            status.innerText = "‚ù§Ô∏è Sending...";
            btn.innerText = "Sending...";

            emailjs.send(EMAIL_SERVICE_ID, EMAIL_TEMPLATE_ID, {
                to_name: 'Gattu',
                message: 'Someone clicked the Send Love button on your fan page!'
            }, EMAIL_PUBLIC_KEY).then(() => {
                status.innerText = "‚úÖ Love Sent to Gattu via Email!";
                btn.innerText = "Sent! ‚ù§Ô∏è";
            }, (err) => {
                status.innerText = "‚ùå Email failed (Quota exceeded or Network error)";
                console.error(err);
                btn.disabled = false;
                btn.innerText = "Try Again";
            });
        }

        // --- 2. GAME LOGIC ---
        let game = { score: 0, gps: 0, clickPower: 1, items: [
            { id: 0, name: "Gattu's Vocab", cost: 50, rate: 0, clickBoost: 5, desc: "+5 per click", count: 0 },
            { id: 1, name: "Gattu's Notebook", cost: 100, rate: 2, clickBoost: 0, desc: "+2 / sec", count: 0 },
            { id: 2, name: "Gattu's Dog", cost: 500, rate: 15, clickBoost: 0, desc: "+15 / sec", count: 0 },
            { id: 3, name: "Gaming Setup", cost: 2000, rate: 50, clickBoost: 0, desc: "+50 / sec", count: 0 },
            { id: 4, name: "Gattu's Car", cost: 10000, rate: 250, clickBoost: 0, desc: "+250 / sec", count: 0 }
        ]};

        // Load Save
        if(localStorage.getItem('gattuGameData')) game = JSON.parse(localStorage.getItem('gattuGameData'));
        if(localStorage.getItem('gattuUserName')) document.getElementById('gamer-name').value = localStorage.getItem('gattuUserName');

        // --- FIX: INITIALIZE SHOP (Run ONCE) ---
        function initShop() {
            const shopDiv = document.getElementById('shop');
            shopDiv.innerHTML = ""; // Clear existing
            
            game.items.forEach(item => {
                // Create the DIV
                const el = document.createElement('div');
                el.className = 'shop-item';
                el.id = `item-box-${item.id}`; // Give it a stable ID
                el.onclick = () => buyItem(item.id);
                
                // Set the internal HTML
                el.innerHTML = `
                    <strong id="name-${item.id}">${item.name}</strong> 
                    <span id="count-${item.id}">(${item.count})</span>
                    <br>
                    <span style="color:#d81b60">üí∞ <span id="cost-${item.id}">${item.cost.toLocaleString()}</span></span>
                    <br>
                    <small>${item.desc}</small>
                `;
                shopDiv.appendChild(el);
            });
            updateShopUI(); // Set initial disabled states
        }

        // --- FIX: UPDATE SHOP (Run OFTEN) ---
        function updateShopUI() {
            // Update Score Text
            document.getElementById('score').innerText = Math.floor(game.score).toLocaleString();
            document.getElementById('gps').innerText = game.gps;

            // Update Buttons (Enable/Disable/Text)
            game.items.forEach(item => {
                const box = document.getElementById(`item-box-${item.id}`);
                const costSpan = document.getElementById(`cost-${item.id}`);
                const countSpan = document.getElementById(`count-${item.id}`);

                if(box) {
                    // Update Text
                    costSpan.innerText = item.cost.toLocaleString();
                    countSpan.innerText = `(${item.count})`;

                    // Update Disabled State
                    if (game.score >= item.cost) {
                        box.classList.remove('disabled');
                    } else {
                        box.classList.add('disabled');
                    }
                }
            });
        }

        function clickHeart() { 
            game.score += game.clickPower; 
            updateShopUI(); // Update UI immediately
        }
        
        function buyItem(id) {
            const item = game.items[id];
            // Check if affordable
            if(game.score >= item.cost) {
                game.score -= item.cost; 
                item.count++; 
                item.cost = Math.ceil(item.cost * 1.5);
                
                // Apply Boosts
                if(item.clickBoost > 0) game.clickPower += item.clickBoost;
                if(item.rate > 0) game.gps += item.rate;
                
                localStorage.setItem('gattuGameData', JSON.stringify(game));
                updateShopUI(); // Update UI immediately
            }
        }

        // Run Init ONCE on load
        initShop();

        // Game Loop (Updates Score & UI)
        setInterval(() => { 
            if(game.gps > 0) { 
                game.score += (game.gps / 10); 
                updateShopUI(); // Smooth updates
            } 
        }, 100);

        // Auto Save
        setInterval(() => { localStorage.setItem('gattuGameData', JSON.stringify(game)); }, 5000);

    </script>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-app.js";
        import { getFirestore, collection, addDoc, getDocs, query, orderBy, limit, serverTimestamp } 
        from "https://www.gstatic.com/firebasejs/12.8.0/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyBHq9QOKiG_twwGtdZsnO1-grHWh2FXuVk",
            authDomain: "gattufanpage.firebaseapp.com",
            projectId: "gattufanpage",
            storageBucket: "gattufanpage.firebasestorage.app",
            messagingSenderId: "1000778970327",
            appId: "1:1000778970327:web:17a0f327f76129c2662c92"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // Make functions globally available to HTML buttons
        window.pushScoreToFirebase = async function() {
            const name = document.getElementById('gamer-name').value;
            const status = document.getElementById('upload-status');
            
            if(!name) { alert("Please enter your name!"); return; }
            localStorage.setItem('gattuUserName', name);
            
            status.innerText = "Uploading...";
            
            try {
                await addDoc(collection(db, "leaderboard"), {
                    name: name,
                    score: Math.floor(game.score),
                    timestamp: serverTimestamp()
                });
                status.innerText = "‚úÖ Success! Board updating...";
                window.fetchLeaderboard();
            } catch (error) {
                console.error("Error:", error);
                status.innerText = "‚ùå Error: " + error.message;
            }
        }

        window.fetchLeaderboard = async function() {
            const tbody = document.getElementById('leaderboard-body');
            try {
                const q = query(collection(db, "leaderboard"), orderBy("score", "desc"), limit(10));
                const querySnapshot = await getDocs(q);
                
                tbody.innerHTML = "";
                let rank = 1;
                querySnapshot.forEach((doc) => {
                    const data = doc.data();
                    tbody.innerHTML += `<tr><td>#${rank++}</td><td>${data.name}</td><td>${data.score.toLocaleString()}</td></tr>`;
                });
            } catch (error) {
                console.error("Error:", error);
                tbody.innerHTML = `<tr><td colspan="3">Loading failed.</td></tr>`;
            }
        }
        
        // Initial load
        window.fetchLeaderboard();
    </script>

</body>
</html>
